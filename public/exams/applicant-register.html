<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ø§Ù…ØªØ­Ø§Ù† â€” Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
 <script src="https://cdn.tailwindcss.com"></script>
 <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
 <style>
  :root {
   --qatar-burgundy: #800020;
   --bg-light: #FFFFFF;
   --text-dark: #1f2937;
  }
  body {
   font-family: 'Cairo', ui-sans-serif, system-ui;
   background-color: #F8F9FA;
   color: var(--text-dark);
   line-height: 1.6;
  }
  .q-card {
   background-color: var(--bg-light);
   border: none;
   box-shadow: 0 10px 30px rgba(0,0,0,0.08);
   padding: 3rem;
   border-radius: 20px;
  }
  .btn-primary {
   background-color: var(--qatar-burgundy);
   color: white;
   transition: background-color 0.3s, transform 0.1s;
  }
  .btn-primary:hover {
   background-color: #A61E4D;
   transform: translateY(-2px);
   box-shadow: 0 4px 8px rgba(128, 0, 32, 0.3);
  }
  label {
   display: block;
   font-weight: 700;
   margin-bottom: 0.5rem;
   color: var(--qatar-burgundy);
   font-size: 1.1rem;
  }
  input[type="text"], input[type="email"], select {
   width: 100%;
   padding: 0.75rem 0.5rem;
   margin-bottom: 1.5rem;
   border: none;
   border-bottom: 3px solid var(--qatar-burgundy);
   border-radius: 0;
   font-size: 1.1rem;
   background-color: transparent;
   transition: border-bottom-color 0.3s;
  }
  input[type="text"]:focus, input[type="email"]:focus, select:focus {
   outline: none;
   border-bottom-color: #A61E4D;
   background-color: #FFF5F7;
  }
  .token-box {
   border: 2px solid var(--qatar-burgundy);
   padding: 2rem;
   border-radius: 16px;
   background-color: #FFF5F7;
   margin-top: 2rem;
  }
  .token-box p {
   margin-bottom: 0.5rem;
   font-weight: 700;
   color: var(--text-dark);
   font-size: 1rem;
  }
  .token-text {
   font-family: monospace;
   font-size: 1.2rem;
   color: white;
   background: var(--qatar-burgundy);
   padding: 0.5rem 1rem;
   border-radius: 8px;
   display: inline-block;
   letter-spacing: 2px;
   font-weight: bold;
  }
  .exam-info {
   display: flex;
   gap: 1rem;
   flex-wrap: wrap;
   margin-top: 0.5rem;
  }
  .exam-info div {
   flex: 1 1 45%;
  }
  .note {
   margin-top: 1rem;
   font-size: 0.9rem;
   color: #555;
   font-weight: 500;
  }

  /* Loading spinner */
  .loader {
   position: relative;
   width: 48px;
   height: 48px;
   margin: 1.5rem auto;
  }
  .loader:before {
   content: '';
   box-sizing: border-box;
   position: absolute;
   top: 0;
   left: 0;
   width: 48px;
   height: 48px;
   border: 4px dashed var(--qatar-burgundy);
   border-radius: 50%;
   animation: spinDashed 1s linear infinite;
  }
  @keyframes spinDashed {
   0% { transform: rotate(0deg);}
   100% { transform: rotate(360deg);}
  }
 </style>
</head>

<body>
 <div class="max-w-xl mx-auto p-6">
  <header class="mb-8 text-center">
   <img src="/exams/logo.svg" alt="logo" class="mx-auto h-20 object-contain rounded" /> 
   <h1 class="text-3xl font-extrabold text-qatar-burgundy mt-5">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†</h1>
  </header>

  <main class="q-card">
   <form id="applicantForm">
    <label for="name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
    <input type="text" id="name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required />

    <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
    <input type="email" id="email" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required />

    <label for="specialization">Ø§Ù„ØªØ®ØµØµ</label>
    <select id="specialization" required>
     <option value="" disabled selected>Ø§Ø®ØªØ± ØªØ®ØµØµÙƒ</option>
     <option value="Ø¹Ù„ÙˆÙ…">Ø¹Ù„ÙˆÙ…</option>
     <option value="Ø§Ù„Ø­ÙˆØ³Ø¨Ø© ÙˆØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª">Ø§Ù„Ø­ÙˆØ³Ø¨Ø© ÙˆØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
     <option value="Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
     <option value="Ù…Ø¹Ù„Ù… ØµÙ">Ù…Ø¹Ù„Ù… ØµÙ</option>
     <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
     <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
     <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
     <option value="Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø¬ØªÙ…Ø§Ø¹ÙŠØ©">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</option>
     <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠÙ‡">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠÙ‡</option>

    </select>

    <button type="submit" class="btn-primary w-full p-4 rounded-xl font-bold mt-4 text-lg">
     ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„
    </button>
   </form>

   <div id="loadingSpinner" class="loader hidden"></div>
   
   <div id="errorAlert" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-4" role="alert">
    <span class="block sm:inline" id="errorMessage"></span>
   </div>


   <div id="resultBox" class="token-box hidden">
    <p>Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:</p>
    <span class="token-text" id="tokenText"></span>

    <div class="exam-info">
     <div>
      <p>Ø§Ù„ØªØ§Ø±ÙŠØ®:</p>
      <span id="examDate" class="text-gray-700 font-bold text-lg"></span>
     </div>
     <div>
      <p>Ø§Ù„Ø³Ø§Ø¹Ø©:</p>
      <span id="examTime" class="text-gray-700 font-bold text-lg"></span>
     </div>
    </div>

    <p class="note">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ù‡ÙŠ Ø¨ØªÙˆÙ‚ÙŠØª Ù‚Ø·Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ (Asia/Qatar).</p>

    <p class="mt-4">Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†:</p>
    <a href="#" id="examLink" class="text-qatar-burgundy font-semibold underline text-lg break-all" target="_blank"></a>

    <p class="mt-4 text-base text-gray-500 font-normal">
     ÙŠØ±Ø¬Ù‰ Ø­ÙØ¸ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯.
    </p>
   </div>
  </main>
 </div>

 <script>
  /*
   =================================================================================
   âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‚ÙŠØ¯ Ø§Ù„Ù€ 15 Ø¯Ù‚ÙŠÙ‚Ø© âš ï¸
   
   * Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ¹Ø¯Ù… Ø§Ù„ØªÙ„Ø§Ø¹Ø¨ØŒ ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ù…Ù†Ø·Ù‚ Ù…Ù†Ø¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù‚Ø¨Ù„ 15 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† 
    **Ø­ØµØ±ÙŠÙ‹Ø§** Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… (ÙÙŠ Ù…Ù„Ù server.js Ø¶Ù…Ù† Ù…Ø³Ø§Ø± /api/applicant/register_token).
   
   * ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†: 
    `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ > (ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† - 15 Ø¯Ù‚ÙŠÙ‚Ø©)`
   * Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø´Ø±Ø· ØµØ­ÙŠØ­Ø§Ù‹ (Ø£ÙŠ ÙØ§Øª Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³Ù…ÙˆØ­)ØŒ ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ù† ÙŠØ±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ ÙˆÙŠØ¹ÙŠØ¯ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø®Ø·Ø£ (Ù…Ø«Ù„ status 400 Ø£Ùˆ 500) Ù…Ø¹ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø¶Ø­Ø©ØŒ Ù…Ø«Ù„Ø§Ù‹:
    `{ success: false, error: "ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø§Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù‚Ø¨Ù„ 15 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†." }`
  
   * Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ (Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù) Ø¬Ø§Ù‡Ø² Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆØ¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© displayError.
   =================================================================================
  */

  async function registerApplicant(data) {
   try {
    const res = await fetch("/api/applicant/register_token", {
     method: "POST",
     headers: { "Content-Type": "application/json" },
     body: JSON.stringify(data)
    });
    // âœ… Ø³ÙŠØªÙ… ØªÙ…Ø±ÙŠØ± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ù‡Ù†Ø§ Ø¥Ø°Ø§ ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª.
    const result = await res.json();
    if (!res.ok && !result.success) { 
     // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ùˆ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù… ÙŠØ±Ø¬Ø¹ success: true
     throw new Error(result.error || `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±: ${res.status}`);
    }
    return result;
   } catch (err) {
    console.error("Registration failed:", err);
    return { success: false, error: err.message || "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£Ùˆ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª." };
   }
  }

  const form = document.getElementById("applicantForm");
  const resultBox = document.getElementById("resultBox");
  const tokenText = document.getElementById("tokenText");
  const examDateEl = document.getElementById("examDate");
  const examTimeEl = document.getElementById("examTime");
  const examLinkEl = document.getElementById("examLink");
  const loadingSpinner = document.getElementById("loadingSpinner");
  const errorAlert = document.getElementById("errorAlert");
  const errorMessageEl = document.getElementById("errorMessage");

  function displayError(message) {
   errorMessageEl.textContent = message;
   errorAlert.classList.remove("hidden");
   errorAlert.scrollIntoView({ behavior: "smooth" });
  }
  
  function hideError() {
    errorAlert.classList.add("hidden");
  }

  form.addEventListener("submit", async (e) => {
   e.preventDefault();
   const name = document.getElementById("name").value.trim();
   const email = document.getElementById("email").value.trim();
   const specialization = document.getElementById("specialization").value;

   if (!name || !email || !specialization) {
    displayError("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");
    return;
   }

   // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„ÙˆØ¯ÙŠÙ†Ø¬ ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬/Ø§Ù„Ø®Ø·Ø£
   resultBox.classList.add("hidden");
   hideError();
   loadingSpinner.classList.remove("hidden");
   
   const data = { name, email, specialization };
   const response = await registerApplicant(data);
   
   // Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù„ÙˆØ¯ÙŠÙ†Ø¬ Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØªÙŠÙ† (Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
   setTimeout(() => {
    loadingSpinner.classList.add("hidden");

    if (!response.success) {
     displayError(response.error || "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
     return;
    }

    const token = response.token;
    const exam = response.exam; // ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…ÙØ±Ø³Ù„Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±

    if (exam && exam.displayDate) {
     // ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ø§Ù„ØªÙŠ ØªÙ… ØªÙ†Ø³ÙŠÙ‚Ù‡Ø§ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
     examDateEl.textContent = exam.displayDate;
     examTimeEl.textContent = exam.displayTime;
    } else {
     // Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù…ØªØ­Ø§Ù† (Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¨Ø³Ø¨Ø¨ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±)
     examDateEl.textContent = "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØ§Ø±ÙŠØ® (ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…)";
     examTimeEl.textContent = "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¹Ø© (ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…)";
    }
    
    tokenText.textContent = token;
    
    // Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø«Ø§Ø¨Øª Ø§Ù„Ø¢Ù†
    const link = `https://ammarbnyasir.com/exams/applicant-exam`; 
    examLinkEl.href = link;
    examLinkEl.textContent = link;

    resultBox.classList.remove("hidden");
    resultBox.scrollIntoView({ behavior: "smooth" });
   }, 2000);
  });
 </script>
</body>
</html>